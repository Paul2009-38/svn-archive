# This is a start for an (almost) cut'n past installation description for mapnik-osm-renderer

# ----------- As User osm:
svn.openstreetmap.org/utils/planet-mirror/planet-mirror.pl -v 
# This takes some time; let it run in the background
# As soon as this is finished:
~/svn.openstreetmap.org/utils/osm2pgsql/osm2pgsql planet-061120-a.osm > planet-061120-a.sql

# ----------- As User  root:
apt-get install build-essential libfreetype6-dev libltdl3-dev \
libpng12-dev  libtiff4-dev libboost-thread-dev libboost-filesystem-dev \
libboost-serialization-dev libboost-regex-dev libboost-python-dev \
libboost-program-options-dev proj python-imaging scons \
postgresql-8.1 postgresql-8.1-plruby postgresql-8.1-postgis \
postgresql-client-8.1 postgresql-contrib-8.1 postgresql-doc-8.1 \
postgresql-plperl-8.1 postgresql-plpython-8.1 \
postgresql-server-dev-8.1 \
libboost-python-dev python2.4-dev imagemagick

cd /home/osm/mapnik
python scons/scons.py install
python scons/scons.py PGSQL_INCLUDES=/usr/include/postgresql \
       PGSQL_LIBS=/usr/lib/postgresql/8.1/lib install

# ----------- As User Postgres
su postgres
createdb -Upostgres  -EUTF8 gis
createuser -Upostgres -S -D -R osm
echo "GRANT ALL ON SCHEMA PUBLIC TO osm;" | psql -Upostgres gis
createlang plpgsql gis
psql -Upostgres gis </usr/share/postgresql-8.1-postgis/lwpostgis.sql \
     2>&1 | grep -v -e 'FEHLER:  aktuelle Transaktion' \
     -e 'ERROR:  current transaction is aborted' \
     -e 'CREATE FUNCTION' -e OPERATOR


echo "GRANT ALL on geometry_columns TO osm;" | psql -Upostgres gis
echo "GRANT ALL on spatial_ref_sys TO osm;" | psql -Upostgres gis
echo "CREATE TABLE planet_osm (   osm_type    char(1),
   osm_id      bigint,   name        text,   place       text,   landuse     text,
   leisure     text,   waterway    text,   highway     text,   amenity     text,
   tourism     text,   learning    text);" | psql -Upostgres gis
echo "SELECT AddGeometryColumn('planet_osm', 'way', 4326, 'GEOMETRY', 2);" | psql -Upostgres gis
echo "ALTER TABLE planet_osm ADD CONSTRAINT pk__planet_osm PRIMARY KEY (osm_type, osm_id);" | psql -Upostgres gis
echo "CREATE INDEX planet_spatial_idx ON planet_osm USING gist (way GIST_GEOMETRY_OPS);" | psql -Upostgres gis

# Now we need the result from the osm2pgsql command
time psql -Upostgres gis < ~osm/osm/planet/planet-061120-a.sql >~/insert.log
# takes about 45minutes on a 2GHz machine


scp -r dev.openstreetmap.org:/home/artem/vmap0 .

# as user osm:
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/lib

# From here on the cut'n paste part stopps

vi svn.openstreetmap.org/utils/mapnik/generate_tiles.py
vi svn.openstreetmap.org/utils/mapnik/osm.xml
and change the path to your installation:
 /home/artem/
 /home/nick/
 /data/...
 /media/disk/...

vi svn.openstreetmap.org/utils/mapnik/osm.xml
   set the host connection to your local machine:
      <Parameter name="host">/var/run/postgresql</Parameter>


vi svn.openstreetmap.org/utils/mapnik/generate_tiles.py
    replace with your area
    bbox = (-2, 50.0,1.0,52.0)

# Upload the tiles-output to dev.openstreetmap.org or  mail a tar file to steve
rsync --size-only -r -e ssh ~/osm/tiles dev.openstreetmap.org:
